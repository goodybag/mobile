<!DOCTYPE HTML>
<!--<html manifest="cache.mf">-->
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, minimum-scale=1, user-scalable=no" />

    <link rel="stylesheet" href="/static/css/reset.css" />
    <link rel="stylesheet" href="/static/css/gb-loader.css" />
    <link rel="stylesheet" href="/static/css/main.css" />

    <!-- phonegap -->
    <script src="/static/3/phonegap-1.4.1.js"></script>
    <!--phonegap facebook plugin -->
    <script src = "/static/3/pg-plugin-fb-connect.js"></script>
    <!-- facebook js sdk -->
    <!--<script src="/static/3/facebook_js_sdk.js"></script>-->

    <script>
      window.applicationCache.addEventListener('updateready', function(e) {
        if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
          // Browser downloaded a new app cache.
          // Swap it in and reload the page to get the new hotness.
          // console.log("CACHE MANIFEST - CHANGES FOUND RELOADING");
          // console.log(location);
          window.applicationCache.swapCache();
          if (confirm('A new version of this site is available. Load it?')) {
            window.location.reload();
          }
        } else {
          //console.log("CACHE MANIFEST - NO CHANGES");
        }
      }, false);
    </script>
    <script src="/static/3/jquery-1.7.1.min.js"></script>
    <script src="/static/3/serializeObject.js"></script>
    <script src="/static/3/sammy-latest.min.js"></script>
    <script src="/static/3/sugar-1.2.3.min.js"></script>
    <script src="/static/3/handlebars-1.0.0.beta.4.js"></script>
    <script src="/static/3/moment-1.3.0.min.js"></script>
    <script src="/static/3/jquery.qrcode.js"></script>
    <script src="/static/3/qrcode.js"></script>
    <script src="/static/3/sprintf-0.7-beta1.js"></script>
    <script src="http://www.goodybag.com/static/js/api-client.js"></script>
    <script src="http://www.goodybag.com/static/js/api-sync-client.js"></script>

    <script src="/static/js/utils.js"></script>
    <script src="/static/js/globals.js"></script>
    <script src="/static/js/config.js"></script>
    <script src="/static/js/functions.js"></script>
    <script src="/static/js/transitions.js"></script>
    <script src="/static/js/templates.js"></script>
    <script src="/static/js/models.js"></script>
    <script src="/static/js/views.js"></script>
    <script src="/static/js/collections.js"></script>
    <script src="/static/js/routes.js"></script>
    <script src="/static/js/routers.js"></script>
    <script src="/static/js/app.js"></script>

    <script src="/static/js/handlebar-helpers.js"></script>
    <script src="/static/js/streamParser.js"></script>
  </head>
  <body id="body">
    <div id="fb-root"></div>
  </body>
  <script>
  //if an apple mobile device
  // alert(navigator.userAgent);
  if ((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)) || (navigator.userAgent.match(/iPad/i))){
    if(navigator.userAgent.match(/Safari/i)){//not in the app
      // alert("not in app");
      console.log("attempting to get facebook");
      $.getScript("http://connect.facebook.net/en_US/all.js#xfbml=0&appId=152282721508707", function(data, status, xhr){
        console.log("initializing facebook");
        FB.init({appId: "152282721508707"});
      });
    } else { //in the app
      // alert("in app");
      $.getScript("/static/3/facebook_js_sdk.js", function(data, status, xhr){
        // alert("got script");
        document.addEventListener('deviceready', function() {
          // alert("device is ready");
          console.log("device is ready");
          FB.init({
            appId: "152282721508707",
            nativeInterface: PG.FB
          });
          console.log("facebookInitialized");
          // alert("facebookInitialized");
        });
      });
    }
  } else {
    console.log("attempting to get facebook");
    $.getScript("http://connect.facebook.net/en_US/all.js#xfbml=0&appId=152282721508707", function(data, status, xhr){
      console.log("initializing facebook");
      FB.init({appId: "152282721508707"});
    });
  }
  </script>
</html>